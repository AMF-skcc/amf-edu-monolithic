<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.amf.edu.monolithic.domain.repository.AttendanceRepository">

    <select id="selectAllAttendance" resultType="Attendance">
        SELECT A.ID
             , C.ID AS COURSE_ID
             , C.NAME AS COURSE_NAME
             , M.ID AS MEMBER_ID
             , M.NAME AS MEMBER_NAME
        FROM ATTENDANCE A
                 INNER JOIN COURSE C
                            ON C.ID = A.COURSE_ID
                 INNER JOIN MEMBER M
                            ON M.ID = A.MEMBER_ID
    </select>

    <select id="selectAttendanceById" resultType="Attendance">
        SELECT A.ID
             , C.ID AS COURSE_ID
             , C.NAME AS COURSE_NAME
             , M.ID AS MEMBER_ID
             , M.NAME AS MEMBER_NAME
        FROM ATTENDANCE A
                 INNER JOIN COURSE C
                            ON C.ID = A.COURSE_ID
                 INNER JOIN MEMBER M
                            ON M.ID = A.MEMBER_ID
        WHERE A.ID = #{id}
    </select>

    <select id="selectAttendanceByMemberId" resultType="Attendance">
        SELECT A.ID
             , C.ID AS COURSE_ID
             , C.NAME AS COURSE_NAME
             , M.ID AS MEMBER_ID
             , M.NAME AS MEMBER_NAME
        FROM ATTENDANCE A
                 INNER JOIN COURSE C
                            ON C.ID = A.COURSE_ID
                 INNER JOIN MEMBER M
                            ON M.ID = A.MEMBER_ID
        WHERE A.MEMBER_ID = #{memberId}
    </select>

    <insert id="createAttendance">
        INSERT INTO
            ATTENDANCE(ID
                 , COURSE_ID
                 , MEMBER_ID)
        VALUES (
                #{id},
                #{courseId},
                #{memberId}
                )
    </insert>

    <update id="updateAttendance">
        UPDATE ATTENDANCE
        SET
            COURSE_ID = #{attendance.courseId}
          , MEMBER_ID = #{attendance.memberId}
        WHERE
            ID = #{attendanceId}
    </update>

    <delete id="deleteAttendance">
        DELETE FROM ATTENDANCE
        WHERE
            ID = #{attendanceId}
    </delete>

</mapper>
